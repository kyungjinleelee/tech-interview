# 다중 서버 환경에서 세션 기반 인증 방식을 사용하는 경우 발생할 수 있는 문제점은 무엇인가요?
다중 서버 환경에서 세션 기반 인증 방식을 사용하는 경우에는 **세션 불일치 문제**가 발생할 수 있습니다. 

## 문제 상황: 세션 불일치(Session Inconsistency) 문제
다중 서버(멀티 서버) 환경에서 세션 기반 인증을 사용할 때 가장 흔하게 발생하는 문제는 **세션 불일치** 현상입니다.
만약 서버 A, B를 관리하고 있을 때, 로드밸런서는 사용자의 요청을 상황에 맞게 A, B 중 한 곳으로 전달합니다. 유효한 로그인 요청이 A 서버로 처음 도착하면 사용자에 대한 세션 정보는 A 서버에 저장됩니다. 
이후에 해당 사용자의 또 다른 요청이 로드 밸런서에 도착했을 때, B 서버로 도착하게 되면 사용자의 세션 데이터가 존재하지 않기 때문에 요청이 제대로 처리되지 않습니다. 이를 세션 불일치 문제라고 합니다.

### 발생 원리
- 여러 대의 웹 서버(예: A, B 서버)에 로드밸런서를 통해 사용자의 요청이 분산됨
- 사용자가 로그인하면 세션 정보가 해당 요청을 처리한 서버(A)에만 저장됨
- 그 사용자의 다음 요청이 로드밸런서에 의해 다른 서버(B)로 전달되면, 서버 B에는 세션 정보가 없으므로 인증이 되지 않고 로그아웃 등 예기치 않은 동작이 발생
- 즉, 서버 간에 사용자의 인증 상태(세션)가 일치하지 않는 문제가 발생

### 예시 시나리오
1. 사용자가 로그인 → 서버 A에 세션 생성
2. 두 번째 요청이 서버 B로 전달 → 서버 B에는 해당 세션이 없어 인증 실패

이렇게 세션 기반 인증을 단일 서버처럼 설계하면 다중 서버에서는 "사용자의 인증 정보가 여러 서버에 불일치"하는 현상이 자주 발생할 수 있습니다.

---

## 해결방안 및 각 방식의 장단점
세션 불일치 문제는 크게 3가지 방식으로 해결할 수 있습니다. 스티키 세션 방식, 세션 클러스터링 방식, 스토리지 분리 방식입니다.

### 1) 스티키 세션(Sticky Session)

**개념:**  
사용자별로 세션 정보를 최초로 저장한 서버에 계속 요청이 갈 수 있도록 로드밸런서를 설정하는 방법입니다. 쿠키, IP 등으로 사용자 요청을 특정 서버에 묶어줍니다.

**장점:**  
- 설정이 쉬운 가장 단순한 방식
- 별도의 세션 복제나 외부 스토리지가 필요 없음

**단점:**  
- 특정 서버에 트래픽 몰림 현상(로드밸런싱 효과 저하)
- 세션 메모리를 분산하지 못하여 확장성 저하
- 세션을 보관한 서버가 다운되면, 사용자는 로그인 절차를 다시 밟아야 함

---

### 2) 세션 클러스터링(Session Replication / Session Clustering)

**개념:**  
한 서버에서 생성된 세션 정보를 다른 서버들로 복제하여, 모든 서버가 동일한 세션 정보를 갖도록 하는 방식입니다.

**장점:**  
- 세션 정보가 여러 서버에 항상 존재(서버 장애 대비 가능)
- 스티키 세션 방식보다 서버간 자원 활용도가 높음

**단점:**  
- 세션 데이터 복제에 따른 네트워크 오버헤드 발생
- 모든 서버에서 동일 데이터 유지하느라 메모리 비효율
- 세션 복제 중 일시적 지연이 발생하면 세션 불일치 문제가 남아 있을 수 있음

---

### 3) 스토리지 분리 방식(External Session Storage)

**개념:**  
세션 정보를 외부의 별도 저장소(주로 Redis, Memcached, DB 등)에 저장하여, 모든 서버가 공통 외부 스토리지를 참조하여 세션을 확인하는 방식입니다.

**장점:**  
- 여러 서버가 동일한 세션 저장소를 사용하므로 세션 불일치 문제 원천 해결
- 서버 추가/제거가 자유롭고, 확장성이 가장 우수

**단점:**  
- 외부 세션 저장소 자체의 장애 시 전체 서비스에 영향(단일 장애 지점)
- 고가용성(HA) 환경 구성을 위해 복제 등 추가 설정 필요(비용, 복잡성 증가)
- 외부 네트워크/스토리지와의 통신 오버헤드, 일시적 복제 지연에 유의

---

## 추가 고려사항

- 현대 웹서비스에서는 **세션 스토리지를 외부화**(Redis 등)하는 방식이 표준처럼 사용됨
- 세션 객체 크기를 작게 유지하고, 불필요한 데이터는 저장하지 않는 것이 바람직
- 토큰 기반 인증(JWT 등)으로 전환하는 것도 다중 서버 환경에서 널리 사용되는 대안

---

## 4. 정리

| 방식              | 장점                                | 단점                                       |
|-------------------|-------------------------------------|--------------------------------------------|
| 스티키 세션        | 단순, 구현 용이                     | 일부 서버 트래픽 집중, 서버 장애 시 재로그인 필요 |
| 세션 클러스터링    | 서버 장애 대비, 분산처리             | 네트워크 오버헤드, 메모리 비효율, 복제 지연 문제 |
| 스토리지 분리      | 확장성/유연성 최고, 관리 용이         | 저장소 장애, 추가 리소스와 구성 필요           |

---

## 참고자료

- [세션 클러스터링 개념 정리 (하이브리드 클라우드 블로그)](https://hyunseob.github.io/2019/09/22/session-clustering/)
- [Sticky Session vs. Session Replication vs. External Storage (stackoverflow)](https://stackoverflow.com/questions/12205323/sticky-sessions-vs-session-replication)
- [Redis를 활용한 세션 관리 (카카오 기술블로그)](https://tech.kakao.com/2020/08/31/session-management-using-redis/)
- [다중 서버 환경에서의 세션 불일치 문제와 해결방법](https://hudi.blog/session-consistency-issue/)

---

jin, 내용 검토해주시고  
TIL 파일명(예: 다중 서버에서 세션 기반 인증 문제점.md 등) 및  
커밋 경로(예: tech-interview/web/, tech-interview/cs/ 등)  
지정해주시면 바로 커밋 준비 및 진행 도와드리겠습니다!  
수정·추가 요청도 언제든 말씀해 주세요. 😊
